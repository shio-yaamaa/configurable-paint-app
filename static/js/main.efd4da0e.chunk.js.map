{"version":3,"sources":["components/Canvas.tsx","components/PenPreview.tsx","components/ColorPicker.tsx","components/ColorPalette.tsx","components/SizePicker.tsx","components/Toolbar.tsx","HistoryStack.ts","components/App.tsx","hooks/usePaintApp.ts","color.ts","config.ts","index.tsx"],"names":["Canvas","props","useEffect","initCanvas","className","width","height","ref","canvasRef","PenPreview","style","penSize","backgroundColor","color","ColorPicker","type","value","onChange","e","handleColorChange","currentTarget","ColorPalette","colors","map","i","onClick","SizePicker","size","min","max","handleSizeChange","parseInt","Toolbar","paletteColors","length","minPenSize","maxPenSize","handlePenSizeChange","fillCanvas","canUndo","undo","canRedo","redo","clearCanvas","download","handleDownload","href","dataUrl","target","rel","HistoryStack","maxLength","snapshots","position","this","Math","item","slice","push","shift","undefined","snapshot","App","config","canvas","useRef","ctx","current","getContext","useState","initialPenColor","setColor","initialPenSize","setPenSize","hasCanvasInitialized","hasUnsavedChanges","isDrawing","lastX","lastY","historyStack","setCanUndo","setCanRedo","useCallback","imageData","putImageData","initiatedByUser","fillStyle","fillRect","getImageData","startDrawing","event","beginPath","moveTo","offsetX","offsetY","lineTo","stroke","draw","stopDrawing","resumeDrawing","buttons","addEventListener","strokeStyle","lineJoin","lineCap","lineWidth","notifySave","usePaintApp","setDataUrl","toDataURL","window","preventDefault","returnValue","colorQueryParamRegex","defaultConfig","getQueryParamAsPositiveInt","queryParams","paramName","get","int","getQueryParamAsColor","match","getQueryParamAsColorList","values","getAll","filter","getConfigFromQueryParams","URLSearchParams","location","search","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.efd4da0e.chunk.js","sourcesContent":["import React, { useEffect } from 'react';\nimport './Canvas.css';\n\ninterface Props {\n  width: number;\n  height: number;\n  canvasRef?: React.MutableRefObject<HTMLCanvasElement | undefined>;\n  initCanvas: () => void;\n}\n\nexport const Canvas: React.VFC<Props> = (props) => {\n  useEffect(() => {\n    props.initCanvas();\n  })\n\n  return (\n    <div className='Canvas'>\n      <canvas\n        className='Canvas-canvas'\n        width={props.width}\n        height={props.height}\n        ref={props.canvasRef as any}>\n      </canvas>\n    </div>\n  );\n}\n","import React from 'react';\nimport './PenPreview.css';\nimport { Color } from '../types';\n\ninterface Props {\n  color: Color;\n  penSize: number;\n}\n\nexport const PenPreview: React.VFC<Props> = (props) => {\n  return (\n    <div className='PenPreview'>\n      <div\n        className='PenPreview-content'\n        style={{\n          width: props.penSize,\n          height: props.penSize,\n          backgroundColor: props.color,\n        }}>\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport './ColorPicker.css';\nimport { Color } from '../types';\n\ninterface Props {\n  color: Color;\n  handleColorChange: (color: Color) => void;\n}\n\nexport const ColorPicker: React.VFC<Props> = (props) => {\n  return (\n    <div className='ColorPicker'>\n      <input\n        className='ColorPicker-input'\n        type='color'\n        value={props.color}\n        onChange={(e) => props.handleColorChange(e.currentTarget.value)}\n      />\n    </div>\n  );\n}\n","import React from 'react';\nimport './ColorPalette.css';\nimport { Color } from '../types';\n\ninterface Props {\n  colors: Color[];\n  handleColorChange: (color: Color) => void;\n}\n\nexport const ColorPalette: React.VFC<Props> = (props) => {\n  return (\n    <div className='ColorPalette'>\n      {\n        props.colors.map((color, i) => (\n          <div\n            className='ColorPalette-option'\n            key={i}\n            style={{ backgroundColor: color }}\n            onClick={() => props.handleColorChange(color)}>\n          </div>\n        ))\n      }\n    </div>\n  );\n}\n","import React from 'react';\nimport './SizePicker.css';\n\ninterface Props {\n  size: number;\n  min: number;\n  max: number;\n  handleSizeChange: (size: number) => void;\n}\n\nexport const SizePicker: React.VFC<Props> = (props) => {\n  return (\n    <div className='SizePicker'>\n      <input\n        className='SizePicker-range-input'\n        type='range'\n        value={props.size}\n        min={props.min}\n        max={props.max}\n        onChange={(e) => props.handleSizeChange(parseInt(e.currentTarget.value))}\n      />\n      <input\n        className='SizePicker-number-input'\n        type='number'\n        value={props.size}\n        min={props.min}\n        max={props.max}\n        onChange={(e) => props.handleSizeChange(parseInt(e.currentTarget.value))}\n      />\n    </div>\n  );\n}\n","import React from 'react';\nimport './Toolbar.css';\nimport { Color } from '../types';\nimport { PenPreview } from './PenPreview';\nimport { ColorPicker } from './ColorPicker';\nimport { ColorPalette } from './ColorPalette';\nimport { SizePicker } from './SizePicker';\n\ninterface Props {\n  color: Color;\n  paletteColors: Color[];\n\n  penSize: number;\n  minPenSize: number;\n  maxPenSize: number;\n\n  canUndo: boolean;\n  canRedo: boolean;\n\n  dataUrl: string;\n\n  clearCanvas: () => void;\n  fillCanvas: (color: Color) => void;\n\n  handleColorChange: (color: Color) => void;\n  handlePenSizeChange: (size: number) => void;\n\n  undo: () => void;\n  redo: () => void;\n\n  handleDownload: () => void;\n}\n\nexport const Toolbar: React.VFC<Props> = (props) => {\n  return (\n    <aside className='Toolbar'>\n      <div className='Toolbar-top'>\n        <div className='Toolbar-section'>\n          <h1 className='Toolbar-title'>Pen Preview</h1>\n          <PenPreview\n            color={props.color}\n            penSize={props.penSize} />\n        </div>\n        <div className='Toolbar-section'>\n          <h1 className='Toolbar-title'>Color</h1>\n          <ColorPicker\n            color={props.color}\n            handleColorChange={props.handleColorChange} />\n          {\n            props.paletteColors.length > 0 && (\n              <ColorPalette\n                colors={props.paletteColors}\n                handleColorChange={props.handleColorChange} />\n            )\n          }\n        </div>\n        <div className='Toolbar-section'>\n          <h1 className='Toolbar-title'>Pen Size</h1>\n          <SizePicker\n            min={props.minPenSize}\n            max={props.maxPenSize}\n            size={props.penSize}\n            handleSizeChange={props.handlePenSizeChange} />\n        </div>\n        <div className='Toolbar-section'>\n          <button className='Toolbar-button' onClick={() => props.fillCanvas(props.color)}>Fill</button>\n        </div>\n      </div>\n      <div className='Toolbar-bottom'>\n        <button\n          className={`Toolbar-button ${props.canUndo ? '' : 'disabled'}`}\n          onClick={props.undo}>\n          Undo\n        </button>\n        <button\n          className={`Toolbar-button ${props.canRedo ? '' : 'disabled'}`}\n          onClick={props.redo}>\n          Redo\n        </button>\n        <button className='Toolbar-button' onClick={props.clearCanvas}>Clear</button>\n        <a\n          className='Toolbar-button'\n          download='image.png'\n          onClick={props.handleDownload}\n          href={props.dataUrl}\n        >\n          Save\n        </a>\n        <a\n          className='Toolbar-link'\n          href='https://github.com/shio-yaamaa/configurable-paint-app'\n          target='_blank'\n          rel='noreferrer'\n        >\n          About this page\n        </a>\n      </div>\n    </aside>\n  );\n}\n","export class HistoryStack<T> {\n  private readonly maxLength: number;\n  private snapshots: T[] = [];\n  private position = -1;\n\n  constructor(maxLength: number) {\n    this.maxLength = Math.max(maxLength, 1);\n  }\n\n  push(item: T): void {\n    // Discard snapshots that have been preserved for redo\n    this.snapshots = this.snapshots.slice(0, this.position + 1);\n    this.snapshots.push(item);\n\n    if (this.position < this.maxLength) {\n      this.position++;\n    } else {\n      // No more snapshots can be saved; Discard the oldest one\n      this.snapshots.shift();\n    }\n  }\n\n  canUndo(): boolean {\n    return this.snapshots[this.position - 1] !== undefined;\n  }\n\n  canRedo(): boolean {\n    return this.snapshots[this.position + 1] !== undefined;\n  }\n\n  undo(): T | null {\n    if (!this.canUndo()) return null;\n    const snapshot = this.snapshots[this.position - 1];\n    this.position--;\n    return snapshot;\n  }\n\n  redo(): T | null {\n    if (!this.canRedo()) return null;\n    const snapshot = this.snapshots[this.position + 1];\n    this.position++;\n    return snapshot;\n  }\n}\n","import React, { useState, useCallback, useEffect } from 'react';\nimport './App.css';\nimport { Config } from '../types';\nimport { Canvas } from './Canvas';\nimport { Toolbar } from './Toolbar';\nimport { usePaintApp } from '../hooks/usePaintApp'\n\ninterface Props {\n  config: Config;\n}\n\nexport const App: React.VFC<Props> = (props) => {\n  const [\n    {\n      canvas, color, penSize,\n      canUndo, canRedo,\n      hasUnsavedChanges,\n    },\n    {\n      initCanvas, clearCanvas, fillCanvas,\n      handleColorChange, handlePenSizeChange,\n      undo, redo,\n      notifySave,\n    },\n  ] = usePaintApp(props.config);\n\n  const [dataUrl, setDataUrl] = useState('#');\n  const handleDownload = useCallback(() => {\n    if (!canvas || !canvas.current) return;\n    setDataUrl(canvas.current.toDataURL('image/png'));\n    notifySave();\n  }, [canvas, notifySave]);\n\n  useEffect(() => {\n    window.addEventListener('beforeunload', (event) => {\n      if (hasUnsavedChanges.current) {\n        event.preventDefault();\n        event.returnValue = '';\n        return 'Close without saving?';\n      } else {\n        delete event['returnValue'];\n      }\n    });\n  }, []);\n\n  return (\n    <div className='App'>\n      <Toolbar\n        color={color}\n        paletteColors={props.config.paletteColors}\n        penSize={penSize}\n        minPenSize={1}\n        maxPenSize={100}\n        canUndo={canUndo}\n        canRedo={canRedo}\n        dataUrl={dataUrl}\n        clearCanvas={clearCanvas}\n        fillCanvas={fillCanvas}\n        handleColorChange={handleColorChange}\n        handlePenSizeChange={handlePenSizeChange}\n        undo={undo}\n        redo={redo}\n        handleDownload={handleDownload} />\n      <Canvas\n        width={props.config.width}\n        height={props.config.height}\n        canvasRef={canvas}\n        initCanvas={initCanvas} />\n    </div>\n  );\n}\n","import { useCallback, useRef, useState } from 'react';\nimport { HistoryStack } from '../HistoryStack';\nimport { Color, Config } from '../types';\n\ntype PaintAppReturnType = [\n  {\n    canvas: React.MutableRefObject<HTMLCanvasElement | undefined>,\n    color: Color,\n    penSize: number,\n\n    canUndo: boolean,\n    canRedo: boolean,\n\n    hasUnsavedChanges: React.MutableRefObject<boolean>,\n  },\n  {\n    initCanvas: () => void,\n    clearCanvas: () => void,\n    fillCanvas: (color: Color) => void,\n    handleColorChange: (color: Color) => void,\n    handlePenSizeChange: (size: number) => void,\n\n    undo: () => void,\n    redo: () => void,\n\n    notifySave: () => void,\n  },\n];\n\nexport const usePaintApp = (config: Config): PaintAppReturnType => {\n  const canvas = useRef<HTMLCanvasElement>();\n  const ctx = useRef(canvas?.current?.getContext('2d'));\n\n  const [color, setColor] = useState(config.initialPenColor);\n  const [penSize, setPenSize] = useState(config.initialPenSize);\n\n  const hasCanvasInitialized = useRef(false);\n  const hasUnsavedChanges = useRef(false);\n  const isDrawing = useRef(false);\n  const lastX = useRef(0);\n  const lastY = useRef(0);\n\n  const historyStack = useRef(new HistoryStack<ImageData>(30));\n\n  const [canUndo, setCanUndo] = useState(historyStack.current.canUndo());\n  const [canRedo, setCanRedo] = useState(historyStack.current.canRedo());\n\n  const undo = useCallback(() => {\n    if (!ctx.current) return;\n    const imageData = historyStack.current.undo();\n    if (imageData === null) return;\n    ctx.current.putImageData(imageData, 0, 0);\n    setCanUndo(historyStack.current.canUndo());\n    setCanRedo(historyStack.current.canRedo());\n    hasUnsavedChanges.current = true;\n  }, []);\n\n  const redo = useCallback(() => {\n    if (!ctx.current) return;\n    const imageData = historyStack.current.redo();\n    if (imageData === null) return;\n    ctx.current.putImageData(imageData, 0, 0);\n    setCanUndo(historyStack.current.canUndo());\n    setCanRedo(historyStack.current.canRedo());\n    hasUnsavedChanges.current = true;\n  }, []);\n\n  const fillCanvas = useCallback((color: Color, initiatedByUser = true) => {\n    if (!canvas || !canvas.current || !ctx || !ctx.current) return;\n    ctx.current.fillStyle = color;\n    ctx.current.fillRect(0, 0, canvas.current.width, canvas.current.height);\n\n    historyStack.current.push(ctx.current.getImageData(0, 0, canvas.current.width, canvas.current.height));\n    setCanUndo(historyStack.current.canUndo());\n    setCanRedo(historyStack.current.canRedo());\n    if (initiatedByUser) {\n      hasUnsavedChanges.current = true;\n    }\n  }, []);\n\n  const clearCanvas = useCallback((initiatedByUser = true) => {\n    fillCanvas(config.backgroundColor, initiatedByUser);\n  }, [config.backgroundColor, fillCanvas]);\n\n  const startDrawing = useCallback((event: MouseEvent) => {\n    if (!ctx || !ctx.current) return;\n    isDrawing.current = true;\n\n    ctx.current.beginPath();\n    ctx.current.moveTo(event.offsetX, event.offsetY);\n    ctx.current.lineTo(event.offsetX, event.offsetY);\n    ctx.current.stroke();\n\n    [lastX.current, lastY.current] = [event.offsetX, event.offsetY];\n  }, []);\n\n  const draw = useCallback((event: MouseEvent) => {\n    if (!ctx || !ctx.current || !isDrawing.current) return;\n\n    ctx.current.beginPath();\n    ctx.current.moveTo(lastX.current, lastY.current);\n    ctx.current.lineTo(event.offsetX, event.offsetY);\n    ctx.current.stroke();\n\n    [lastX.current, lastY.current] = [event.offsetX, event.offsetY];\n  }, []);\n\n  const stopDrawing = useCallback(() => {\n    if (!isDrawing.current) return;\n    isDrawing.current = false;\n\n    if (!ctx.current || !canvas.current) return;\n    historyStack.current.push(ctx.current.getImageData(0, 0, canvas.current.width, canvas.current.height));\n    setCanUndo(historyStack.current.canUndo());\n    setCanRedo(historyStack.current.canRedo());\n    hasUnsavedChanges.current = true;\n  }, []);\n\n  // The change before and after resuming are both in the same history stack item.\n  // Currently it cannot distinguish between these two scenarios:\n  // - mouseout -> mouseover\n  // - mouseout -> mouseup -> mousedown -> mouseover\n  // Ideally, the latter case should count as two separate history stack items.\n  // If I really want to implement that,\n  // maybe I should consider moving mouse-related event listeners to the document or window.\n  const resumeDrawing = useCallback((event: MouseEvent) => {\n    const isMousePressed = (event.buttons & 1) === 1;\n    if (isMousePressed) {\n      isDrawing.current = true;\n      [lastX.current, lastY.current] = [event.offsetX, event.offsetY];\n    } else {\n      // A history stack item is added when the mouse enters the canvas,\n      // not when the mouse is released outside the canvas.\n      // This is a bit confusing behavior if you carefully observe when the undo/redo buttons activate/deactivate.\n      if (isDrawing.current) {\n        stopDrawing();\n      }\n    }\n  }, [stopDrawing]);\n\n  const initCanvas = useCallback(() => {\n    ctx.current = canvas?.current?.getContext('2d');\n    if (!hasCanvasInitialized.current && canvas && canvas.current && ctx && ctx.current) {\n      canvas.current.addEventListener('mousedown', startDrawing);\n      canvas.current.addEventListener('mousemove', draw);\n      canvas.current.addEventListener('mouseup', stopDrawing);\n      canvas.current.addEventListener('mouseout', draw);\n      canvas.current.addEventListener('mouseover', resumeDrawing);\n\n      ctx.current.strokeStyle = color;\n      ctx.current.lineJoin = 'round';\n      ctx.current.lineCap = 'round';\n      ctx.current.lineWidth = penSize;\n\n      clearCanvas(false);\n\n      hasCanvasInitialized.current = true;\n    }\n  }, [color, penSize, startDrawing, draw, stopDrawing, resumeDrawing, clearCanvas]);\n\n  const handleColorChange = useCallback((color: Color) => {\n    setColor(color);\n    if (ctx.current) {\n      ctx.current.strokeStyle = color;\n    }\n  }, []);\n\n  const handlePenSizeChange = useCallback((size: number) => {\n    if (size < 0) return;\n    setPenSize(size);\n    if (ctx.current) {\n      ctx.current.lineWidth = size;\n    }\n  }, []);\n\n  const notifySave = useCallback(() => {\n    hasUnsavedChanges.current = false;\n  }, []);\n\n  return [\n    {\n      canvas,\n      color,\n      penSize,\n      canUndo,\n      canRedo,\n      hasUnsavedChanges,\n    },\n    {\n      initCanvas,\n      clearCanvas,\n      fillCanvas,\n      handleColorChange,\n      handlePenSizeChange,\n      undo,\n      redo,\n      notifySave,\n    }\n  ];\n};\n","import { Color } from './types';\n\nexport const white: Color = '#ffffff';\nexport const black: Color = '#000000';\n\n// Does not include a '#' since it has a special meaning in URLs.\nexport const colorQueryParamRegex = /^[0-9a-f]{6}$/;\n","import { Config, Color } from './types';\nimport { black, colorQueryParamRegex, white } from './color';\n\nconst defaultConfig: Config = {\n  width: 800,\n  height: 600,\n\n  initialPenColor: black,\n  initialPenSize: 10,\n\n  backgroundColor: white,\n\n  paletteColors: [],\n};\n\nexport const getConfigFromQueryParams = (queryParams: URLSearchParams): Config => {\n  return {\n    width: getQueryParamAsPositiveInt(queryParams, 'width') ?? defaultConfig.width,\n    height: getQueryParamAsPositiveInt(queryParams, 'height') ?? defaultConfig.height,\n\n    initialPenColor: getQueryParamAsColor(queryParams, 'initial_pen_color') ?? defaultConfig.initialPenColor,\n    initialPenSize: getQueryParamAsPositiveInt(queryParams, 'initial_pen_size') ?? defaultConfig.initialPenSize,\n\n    backgroundColor: getQueryParamAsColor(queryParams, 'background_color') ?? defaultConfig.backgroundColor,\n\n    paletteColors: getQueryParamAsColorList(queryParams, 'palette_color') ?? defaultConfig.paletteColors,\n  };\n};\n\nconst getQueryParamAsPositiveInt = (queryParams: URLSearchParams, paramName: string): number | null => {\n  const value = queryParams.get(paramName);\n  if (value === null) return null;\n  const int = parseInt(value);\n  return int > 0 ? int : null;\n};\n\nconst getQueryParamAsColor = (queryParams: URLSearchParams, paramName: string): Color | null => {\n  const value = queryParams.get(paramName);\n  if (value === null) return null;\n  return value.match(colorQueryParamRegex) ? `#${value}` : null;\n};\n\nconst getQueryParamAsColorList = (queryParams: URLSearchParams, paramName: string): Color[] | null => {\n  const values = queryParams.getAll(paramName);\n  if (values.length === 0) return null;\n  return values.filter(value => value.match(colorQueryParamRegex)).map(value => `#${value}`);\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './variables.css';\nimport './index.css';\nimport { App } from './components/App';\nimport { getConfigFromQueryParams } from './config';\n\nconst config = getConfigFromQueryParams(new URLSearchParams(window.location.search));\n\nReactDOM.render(\n  <React.StrictMode>\n    <App config={config} />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}